好，我们现在就专注在 **阶段 1：资源 → 课程结构（Ingestion + 课程建模）**，把这部分单独当一个小项目来规划。

你关心的是两件事：

1. **要开发哪些东西？（具体模块）**
2. **开发计划是啥？（先做什么、后做什么、每一步的目标是什么）**

我会用「**里程碑 → 模块 → 开发步骤**」的方式讲清楚，仍然不写具体代码、也不提脚本名，只讲到“功能 + API/数据结构级别”。

---

# 一、阶段 1 的目标复盘

**阶段 1 的目标：**

> 用户选择 / 上传资源（视频、PPT、文档）后，
> 系统能把这些资源处理成：
> 👉 一门有结构的课程：Course → Lecture → Section（小节）
> 👉 每个 Section 下面挂着对应的文本内容（来自视频转录和课件）

**这个阶段结束时，你应该有：**

* 一套明确的 **课程数据模型**（Course / Lecture / Section / Resource / ContentPiece）
* 一个 **资源接入入口**（前端 or 管理接口），用户可以提供 URL / 文件
* 一条 **处理流水线** 可以从资源跑到：

  * 音频抽取
  * ASR 文本
  * PPT 文本
  * 自动「按小节」组织起来
* 最终：可以通过一个接口拿到**课程大纲 + 每个小节的内容摘要**

还 **没有** 用到向量模型 / RAG / 教学引擎，这些是后续阶段。

---

# 二、阶段 1 的开发里程碑

我建议把阶段 1 划成 4 个小里程碑：

1. **M1：课程 & 资源数据模型设计好**
2. **M2：视频资源处理打通（视频 → 音频 → 转录）**
3. **M3：文档资源处理打通（PPT/PDF → 文本片段）**
4. **M4：自动小节划分 + 课程大纲生成**

每个里程碑内部再拆几个小任务。

---

# 三、M1：课程 & 资源数据模型设计

### 目标

先把“这套系统里一个课程长啥样”想清楚，否则后面的所有处理很难接上。

### 要开发/设计哪些？

#### 1.1 实体模型设计

至少需要这些实体（可以是数据库表，也可以是内存/JSON 结构，MVP 随意实现方式）：

* **Course（课程）**

  * id、名称、简介、创建者、来源说明
* **Resource（原始资源）**

  * id、类型（video / ppt / pdf / text / other）
  * 关联的 course_id
  * 源信息（URL / 文件名）
  * 状态（未处理 / 处理中 / 处理完）
* **Lecture（讲次，选做）**

  * id、course_id、标题、顺序（第几讲）
  * 关联的原始资源（比如某几个视频）
* **Section（知识小节，最重要）**

  * id、course_id、lecture_id
  * 标题（之后可自动生成）
  * 简要描述 / 摘要
  * 顺序（在某个 Lecture 内的顺序）
* **ContentPiece（内容片段）**

  * id、section_id
  * 来源类型（transcript / slide / text）
  * 源资源 id（哪个视频哪一页PPT）
  * 文本内容
  * 时间范围（对视频片段）/ 页码（对 PPT）

#### 1.2 内部约定

* 一门课 = 一个 Course
* 一个 Course 可以有 N 个 Lecture（比如第1讲、第2讲）
* 每个 Lecture 拆成若干 Section（知识点颗粒度）
* Section 底下挂 ContentPiece（用于后续向量化）

### 开发计划（M1）

1. 先用文档写清楚以上实体需要哪些字段、字段类型、关系（ER 图）。
2. 再落到你当前用的存储方式（比如：

   * MVP 阶段可先用 SQLite / JSON 文件存；
   * 后面再升级成真正的数据库也不晚）。
3. 定一个内部约定：**后续所有模块都只围绕这套结构传数据。**

---

# 四、M2：视频资源处理打通（Video → Audio → Transcript）

### 目标

只针对视频资源，打通从“用户给一个 URL”到“能拿到这个视频的转录文本 + 时间轴”。

### 要开发哪些功能？

#### 2.1 视频资源录入 & 状态管理

* 接口：

  * 输入：视频 URL（+ 用户选的 course_id）
  * 输出：创建一个 Resource 记录（类型 = video）
* 资源状态：

  * `pending`：刚创建
  * `downloading`：正在处理
  * `done`：已完成音频+转录
  * `failed`：失败，记录错误信息

#### 2.2 音频抽取

* 针对类型为 video 的 Resource：

  * 使用工具（yt-dlp 等）下载视频并抽取音频
  * 生成一个本地音频路径
  * 记录到 Resource 的附加字段里（比如 `audio_path`）
  * 更新状态（如果音频步骤成功）

#### 2.3 ASR（转录）

* 对已经有 `audio_path` 的视频资源：

  * 调用 ASR（如 Faster-Whisper）
  * 输出：一组带时间戳的片段：

    * 开始时间、结束时间、原始文本
  * 将这些片段保存为 ContentPiece 或一个“中间结果表”（如 TranscriptSegment）：

    * 暂时只关联到 Resource（还没分配到 Section）

#### 2.4 基础监控 & 简单可视化

* 做一个简单的接口/页面：

  * 让你可以看到一个视频资源的处理状态（成功/失败、转录片段数量）
* 不用做复杂 UI，哪怕只是一个 JSON 接口 + Postman 看也可以。

### 开发计划（M2）

按顺序：

1. 定义一个“创建/注册视频资源”的接口
2. 实现音频抽取逻辑
3. 实现音频转录逻辑
4. 把转录结果保存到 ContentPiece 或中间表
5. 做简单检查接口：给一个 video resource id，返回转录片段列表

---

# 五、M3：文档资源处理打通（PPT/PDF → 文本片段）

### 目标

处理用户上传的 PPT / PDF / 文本，让它们也变成结构化的内容片段，可以后面分配到 Section 中。

### 要开发哪些功能？

#### 3.1 文档资源录入

* 接口：

  * 输入：PPT/PDF 文件（+ 课程 id）
  * 输出：创建 Resource 记录（类型 = ppt / pdf）

#### 3.2 PPT 文本解析

* 对类型为 ppt 的资源：

  * 解析每一页：

    * 页码
    * 标题文字
    * bullet 列表 / 主要文案
  * 每一页生成一个 ContentPiece：

    * source_type = slide
    * metadata 里记录 slide_page
    * section_id 暂时为空（后面由 Sectioning 去分配）

#### 3.3 PDF / 纯文本解析（可选）

* 对类型为 pdf 的资源：

  * 按页或按章节标题进行粗粒度切分
  * 生成 ContentPiece
* 对纯文本：

  * 按自然段/标题拆分，生成 ContentPiece

### 开发计划（M3）

1. 跟 M2 类似，先做“资源录入接口 + 状态管理”
2. 再做 PPT 解析流程
3. 测试：给一个 PPT 资源 id，能拿到一组“每页的文本片段列表”
4. 如有需要，再扩展 pdf/text

---

# 六、M4：自动小节划分 + 课程大纲生成（Sectioning）

### 目标

把 M2 & M3 得到的转录片段和 PPT 文本，组织成 **Section**，形成课程大纲。

### 要开发哪些功能？

#### 4.1 初步 Section 划分策略

MVP 做一个简单版本即可，建议策略：

* 对每个视频：

  * 按时间窗口划分（例如：每 3–5 分钟为一个小节）
  * 或根据转录里的“显然的章节语句”（比如“下面我们讲第二个问题”）做进一步优化（可以是后续增强）

* 对 PPT：

  * 每一页默认就是一个 Section
  * 或者与对应时间段对齐（进阶阶段再做）

#### 4.2 Section 数据生成

* 为每个 Course：

  * 遍历它下面的 Resource（视频、PPT）
  * 基于转录 & PPT 生成 Section 列表：

    * `section_id`、`title`（可自动生成）、`lecture_id`、顺序
  * 为每个 Section 分配相关的 ContentPiece：

    * 属于这个时间段的转录片段
    * 属于这个知识点的 PPT 页

#### 4.3 Section 标题 & 描述自动生成（可用 LLM）

* 对于每个 Section：

  * 输入：该 Section 包含的转录片段 + PPT 文本
  * 使用 LLM：

    * 生成一个短标题（比如“损失函数的直观理解”）
    * 生成一段 1–2 句描述，方便展示在课程大纲中

#### 4.4 课程大纲对外接口

* 提供一个接口（后端 API）：

  * 输入：course_id
  * 输出：

    * 课程名
    * 讲次列表
    * 每个讲次下面的 Section 列表（含标题、描述、顺序）

这就是前端以后“课程大纲页面”的数据来源。

### 开发计划（M4）

1. 实现一个 Section 生成流程：

   * 输入：某 course 下的 Resource 与 ContentPiece
   * 输出：Section + Section ↔ ContentPiece 映射关系
2. 实现标题 / 描述生成逻辑：用 LLM 对 Section 内容做 summarization
3. 实现“获取课程大纲”的接口，并用假数据 / 真实数据测试
4. 验证：

   * 看大纲是否能看懂
   * 小节粒度是否合理（太细/太粗都要调整策略）

---

# 七、阶段 1 的整体开发顺序建议

综合起来，阶段 1 的开发计划可以这样排：

1. **先做 M1：数据模型设计**

   * 不写代码之前，先用文档画出关系
   * 然后落到你用的数据库 / 存储方案中

2. **再做 M2 & M3：让视频和 PPT 分别能被“吃进去”**

   * 两条流水线可以并行不同人做：

     * 一个同学搞视频（下载 + ASR）
     * 一个同学搞 PPT 解析
   * 最终都输出到统一的 ContentPiece 结构上

3. **最后做 M4：自动 Section 划分 + 大纲生成**

   * 需要前面的视频转录 / PPT 文本都已经有了
   * 这一步做完，就有 “课程树 + 小节内容” 可用
   * 后续阶段（向量库 / 教学引擎）就可以直接接入

---

如果你觉得这个 **阶段 1 开发计划** 方向 OK，
我们下一步可以更细一点，比如：

* 把「课程结构模型（Course / Lecture / Section / Resource / ContentPiece）」的字段定义写出来（类似表结构设计，但不用写 SQL），方便你和团队讨论；
* 或者，把「资源录入 + 处理状态流转」设计成一个小的状态机图，帮助大家实现时不乱。

你可以告诉我：
**下一步你更想先细化：课程数据模型，还是资源处理流程（状态流转）？**
