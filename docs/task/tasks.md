好，我们现在进入“产品经理给开发拆任务”的模式 😄
这一步只做：**按模块拆解成更细的开发任务 + 标明依赖顺序，不写代码、不写脚本名。**

我会按阶段 + 模块来拆，这样你看起来一目了然，也方便你直接丢给开发同学排期。

---

# 总体视角：MVP 开发阶段划分

1. **阶段 0：基础环境（已完成）**
2. **阶段 1：资源 → 课程结构（Ingestion + 课程建模）**
3. **阶段 2：向量服务 + 向量库（Embedding + Vector Store）**
4. **阶段 3：RAG 能力（检索 + 问答）**
5. **阶段 4：教学引擎（讲解 + 互动）**
6. **阶段 5：教师角色 & 教学风格**
7. **阶段 6：TTS 与音频输出**
8. **阶段 7：前端交互界面**
9. **阶段 8：整合测试 & 调优**

下面开始细拆任务。

---

## 阶段 1：资源 → 课程结构（Ingestion + 课程建模）

> 目标：用户选择/上传资源后，系统能把这些资源变成「可教学的课程结构：课程 → 讲次 → 小节」。

### 1.1 资源输入模块

**任务 1.1.1：设计资源输入形式**

* 支持以下几类输入：

  * 视频链接（B 站 / YouTube）
  * 文档类文件（PPT、PDF）
  * 纯文本（可选，用于用户上传自己整理的 notes）
* 定义资源元信息：

  * 资源类型（video / ppt / pdf / text）
  * 标题
  * 来源 URL / 文件名
  * 上传者、时间

**任务 1.1.2：实现资源上传 / 录入接口**

* 后端接口：接收链接 / 文件 / 文本
* 生成统一的资源记录（存数据库或简单配置）

> 依赖：无（可以直接做）

---

### 1.2 视频处理模块

**任务 1.2.1：视频音频抽取**

* 对每个视频资源：

  * 下载或获取音频轨
  * 存到指定位置，记录路径、时长

**任务 1.2.2：音频转文字（ASR）**

* 对每个音频：

  * 使用语音识别模型生成完整转录文本
  * 输出带时间戳的分段结果（每段包含开始时间、结束时间、文本）
* 记录：

  * 属于哪个课程
  * 属于哪个视频（讲次）

> 依赖：1.1 完成（需要有视频资源）

---

### 1.3 文档处理模块（PPT / PDF / 文本）

**任务 1.3.1：课件文本抽取**

* 对 PPT / PDF：

  * 提取每页的标题和主要文字内容
  * 记录页码与内容的关系

**任务 1.3.2：文本型资源处理**

* 对用户上传的纯文本：

  * 按段落或标题拆分
  * 标注其属于课程的哪一部分（如果用户有指定）

> 依赖：1.1 完成（需要有文档资源）

---

### 1.4 课程结构建模（Course / Lecture / Section）

**任务 1.4.1：设计课程结构模型**

* 定义：

  * 课程（Course）：一组资源构成一个课程
  * 讲次（Lecture）：对应一个或多个视频 / 章节
  * 小节（Section）：一个知识点级别，在讲次之下
* 每个 Section 需要记录：

  * 标题
  * 简要描述（可自动生成）
  * 来源片段列表（转录段落、PPT 页等）

**任务 1.4.2：自动小节划分逻辑（Sectioning 策略）**

* 基于视频转录：

  * 按时间划分（例如每 N 分钟一个小段）
  * 或按转录中停顿/章节标记划分（MVP 可先用简单时间切分）
* 基于 PPT：

  * 每页 PPT 对应一个小节，或作为某小节的补充内容
* 将视频段落与 PPT 页对齐到 Section 层（粗粒度即可）

**任务 1.4.3：课程大纲生成**

* 根据自动划分：

  * 为每个 Section 生成标题（可通过 LLM 简要生成）
  * 形成一份课程大纲（章节 / 小节树）

> 依赖：1.2、1.3 完成（需要有转录和课件内容）

---

## 阶段 2：向量服务 + 向量库（Embedding + Vector Store）

> 目标：把课程内容变成可检索的向量知识库。

### 2.1 向量服务（Embedding Service）

**任务 2.1.1：加载向量模型**

* 使用 Qwen3-Embedding-0.6B
* 能在 GPU 上运行，自动 fallback 到 CPU

**任务 2.1.2：定义向量服务接口**

* 设计一个 HTTP 接口：

  * 输入：一组文本
  * 输出：对应的向量数组
* 支持批量处理

> 依赖：环境准备完成（已具备）

---

### 2.2 文本片段切分（Chunking）

**任务 2.2.1：视频转录文本切分**

* 针对转录内容：

  * 按合理长度（字数 / 句数）切分，得到多个片段
  * 每个片段携带：

    * 所属 Section
    * 原始时间区间

**任务 2.2.2：课件文本切分**

* 针对 PPT / PDF 内容：

  * 按页或按关键点拆分成片段
  * 每个片段携带：

    * 所属 Section
    * 页码信息

> 依赖：1.4 完成（需要知道 Section 信息）

---

### 2.3 向量库构建（Vector Store）

**任务 2.3.1：选型与初始化**

* 使用本地向量数据库（例如：Chroma）
* 初始化一个用于存储所有片段向量和元数据的向量集合

**任务 2.3.2：向量化 & 存储**

* 对所有片段：

  * 调用向量服务获取向量
  * 写入向量库，保存关联 metadata：

    * 课程 / 讲次 / 小节
    * 来源类型（音频转录 / PPT）
    * 时间范围 / 页号

> 依赖：2.1、2.2 完成

---

## 阶段 3：RAG 能力（检索 + 问答支持）

> 目标：给定问题或学习需求，能从课程中检索到相关内容。

### 3.1 检索接口设计

**任务 3.1.1：检索输入与过滤参数定义**

* 输入可以包括：

  * 用户问题
  * 当前课程 ID
  * 当前讲次 / 小节 ID（可选）

* 支持过滤：

  * 仅在当前 Section 检索
  * 在整个课程内检索

**任务 3.1.2：检索排序与返回格式**

* 配置向量相似度检索策略：

  * top-k
  * 相似度阈值
* 返回每条结果：

  * 片段文本
  * 相似度评分
  * 所属 Section / 讲次
  * 来源信息（转录时间段 / PPT 页码）

> 依赖：2.3 完成

---

### 3.2 与 LLM 结合生成回答（基础 RAG）

**任务 3.2.1：RAG 回答模板设计**

* 设计大模型调用模板：

  * 提供检索到的片段内容
  * 提供用户问题
  * 要求基于片段内容回答，避免编造

**任务 3.2.2：输出结构定义**

* 回答需要包含：

  * 教师回答文本
  * 引用的片段列表（方便前端展示出处）

> 依赖：3.1 完成

---

## 阶段 4：教学引擎（讲解 + 互动）

> 目标：让 AI Teacher 具备「讲课 + 提问 + 根据回答调整」的教学行为，而不是单纯问答。

### 4.1 教学会话状态管理

**任务 4.1.1：设计教学状态结构**

* 教学状态包括：

  * 当前课程 / 讲次 / 小节
  * 当前教学阶段：

    * 正在讲解
    * 等待用户回答理解问题
    * 刚回答完提问准备继续
  * 当前进度（已讲到本小节的第几部分）

**任务 4.1.2：教学状态更新逻辑**

* 每次交互后：

  * 根据用户输入类型（学习意图 / 提问 / 反馈）更新状态
  * 决定下一步是继续讲解 / 提问 / 回答问题

> 依赖：课程结构（1.4）、RAG（3.x）

---

### 4.2 完整知识点讲解

**任务 4.2.1：讲解内容生成**

* 对当前 Section：

  * 使用 RAG 检索若干片段
  * 调大模型生成一段结构化、连贯的讲解
  * 保证讲解覆盖本小节核心知识点

**任务 4.2.2：讲解长度与节奏控制**

* 设计简单策略：

  * 每次讲解控制在一定长度（例如 N 字 / M 句）
  * 一次讲完一个“知识点单元”再停下来互动，不要句句停

> 依赖：4.1、3.2 完成

---

### 4.3 互动提问与理解检查

**任务 4.3.1：生成理解检查问题**

* 教学引擎调用大模型：

  * 输入：当前小节的重点内容 / 刚刚的讲解
  * 输出：1–2 个检查理解的问题（不是“懂了吗”，而是具体内容）

**任务 4.3.2：解析用户回答 & 判定理解程度**

* 让大模型对用户回答进行判定：

  * 正确 / 基本正确 / 不够清晰 / 有明显误解
* 根据判定结果生成：

  * 对用户的反馈
  * 是否需要补充解释

**任务 4.3.3：教学节奏调整**

* 教学引擎根据判定：

  * 正确 → 总结关键点 → 进入下一小节或下一知识点
  * 不够 → 换一种解释方式再讲一次
  * 用户明确说“继续” → 跳过理解检查直接继续

> 依赖：4.2 完成（需要讲解内容）

---

## 阶段 5：教师角色 & 教学风格

> 目标：老师的角色和风格可配置，影响讲话方式和教学策略。

### 5.1 教师角色定义

**任务 5.1.1：设计 Teacher Profile 结构**

* 包含：

  * 角色描述（人设）
  * 教学风格：

    * 严谨 / 放松
    * 比喻多 / 公式多
    * 提问多 / 提问少
    * 面向初学者 / 有基础的

**任务 5.1.2：预置几种 teacher profile**

* 例如：

  * “名校教授版”
  * “学长陪你学版”
  * “考前冲刺版”

---

### 5.2 教师角色与 LLM 行为的绑定

**任务 5.2.1：在调用大模型时注入 teacher profile**

* 教学引擎调用大模型时：

  * 将当前教师的人设与风格一起作为系统指令的一部分
  * 影响讲解语气、词汇、案例风格

**任务 5.2.2：教学策略与风格联动**

* 如：

  * 幽默老师：例子多、类比多，提问更轻松
  * 考试型老师：多强调解题套路和考点

> 依赖：4.x 完成（教学引擎已存在）

---

## 阶段 6：TTS 与音频输出

> 目标：所有讲解 / 回答都能生成音频，让用户“听课”。

### 6.1 文本转语音

**任务 6.1.1：选定 TTS 方案**

* 可选本地或云 TTS
* 确定接口形式：输入文本 → 返回音频数据或文件路径

**任务 6.1.2：与教学引擎集成**

* 每次生成讲解 / 回答后：

  * 调用 TTS
  * 生成音频文件
  * 得到音频访问地址

---

### 6.2 音频管理与前端返回格式

**任务 6.2.1：音频文件管理规范**

* 定义：

  * 文件命名
  * 存放位置
  * 清理策略（可后续做）

**任务 6.2.2：统一响应结构**

* 教学引擎对前端的响应中包含：

  * 文本内容
  * 音频地址
  * 引用信息
  * 当前教学状态简要描述（可视化用）

> 依赖：4.x 完成（需要已有文本讲解）

---

## 阶段 7：前端交互界面

> 目标：提供一个可用的 Web 界面，支持对话式学习 + 小节选择 + 听音频。

### 7.1 课程管理 & 大纲视图

**任务 7.1.1：课程列表**

* 列出用户已有的课程（由资源生成）

**任务 7.1.2：课程大纲展示**

* 展示 Lecture / Section 树状结构
* 点击某小节时，通知后端“开始学习这个小节”

---

### 7.2 对话式教学界面

**任务 7.2.1：对话流展示**

* 展示交互消息：

  * 老师消息（文本 + 播放按钮）
  * 学生消息

**任务 7.2.2：输入框与交互规则提示**

* 输入框下方提示：

  * 如何提问（以“老师，”开头）
  * 可以说“继续讲”、“换个方式讲”等

---

### 7.3 教师角色设置

**任务 7.3.1：教师角色选择控件**

* 提供下拉菜单或按钮选项：

  * 教师人设
  * 教学风格选项

**任务 7.3.2：角色切换交互**

* 用户修改老师角色后，前端通知后端
* 后端从下一轮开始使用新 teacher profile

---

### 7.4 音频播放

**任务 7.4.1：音频播放器组件**

* 能根据后端提供的音频地址播放
* 支持播放 / 暂停 / 当前进度显示（可以简单实现）

---

## 阶段 8：整合测试 & 调优

> 目标：从“用户选择资源 → 生成课程 → 选择小节 → 开始学习 → 互动 → 提问 → 听音频”形成完整的体验闭环。

**任务 8.1：端到端流程测试**

* 典型流程：

  * 用户上传 B 站链接 + PPT
  * 系统构建课程
  * 选择一个小节
  * 老师讲解 → 问问题 → 学生回答 → 老师继续讲
  * 学生中途提问
  * 老师回答问题 → 回到课程
  * 全程有音频可听

**任务 8.2：交互逻辑调优**

* 调整：

  * 每次讲解的长度
  * 提问频率
  * 问题难度
  * 对错误回答的回应方式
* 收集一些真实用户的反馈（你自己或者团队内部）

**任务 8.3：性能与稳定性**

* 向量检索耗时
* LLM 调用次数优化
* TTS 延迟优化
* 日志记录与错误处理

---

这样拆完之后，你就有了一份：

> **从需求（用户故事） → 模块 → 细粒度开发任务 → 明确依赖关系** 的完整结构。

你可以用这份直接做：

* 开发排期（按阶段分 Sprint）
* 团队分工（后端同学负责哪些模块、前端同学负责哪些块、谁搞 TTS、谁搞课程结构）

如果你愿意，下一步我可以针对「某一个阶段」帮你再细化成：

* 接口列表（名称、输入、输出）
* 数据结构（课程 / 小节 / Teacher Profile 的字段）

你可以告诉我：
**你想先从哪个阶段开始做详细设计？**（教学引擎 / 课程结构 / 前端交互 / 向量库）
