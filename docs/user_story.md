好，我们把你新补充的两个关键点也纳入设计里：

* ✅ 用户可以自己选择 / 上传学习资源，由系统组装成课程
* ✅ 教师角色 & 教学风格是可配置的（比如严谨教授 / 轻松学长 / 小红书风）

下面是**更新版的「用户故事 ↔ 功能 ↔ 技术方案」总览**。
按照你的要求：**不拆任务、不写脚本、不写代码，只讲对应关系，方便你先确认方向。**

---

## 一、用户故事总览（加入你新说的两个）

MVP 阶段我们有这些核心用户故事：

1. **用户故事 A：用户自己选择/提供学习资源 → 生成课程**
2. **用户故事 B：用户选择教师角色与教学风格**
3. **用户故事 C：选择想学的内容（按小节或自然语言）**
4. **用户故事 D：完整知识点讲解 + 智能互动**
5. **用户故事 E：随时打断老师提问（特定前缀触发）**
6. **用户故事 F：音频学习（播客式体验）**

下面逐条对应功能 & 技术方案。

---

## 二、用户故事 A：用户提供资源 → 系统生成课程

> **作为用户**，
> 我希望可以自己选择/上传要学习的资源（视频、PPT、PDF、文档、网址等），
> 系统能帮我把这些资源处理成一门“课程”，拆成合理的小节，方便后续对话式学习。

### 需要的功能

1. **资源选择 / 上传入口**

   * 支持用户：

     * 粘贴视频链接（B 站 / YouTube / 其他）
     * 上传 PPT / PDF / 文本
   * 可以一次提供一份，也可以提供一批资源，组成一个课程。

2. **资源处理（统一转换为“知识内容”）**

   * 视频 → 音频 → 文本（ASR）
   * PPT / PDF → 文本解析
   * 文本资料 → 直接纳入

3. **自动构建“课程结构”**

   * 将这些资源组织成：

     * 课程（Course）
     * 章节/讲次（Lecture）
     * 小节（Section / 知识点）
   * 每个小节对应一组内容片段（来自不同资源：音频转写、PPT 文本等）

4. **课程保存 & 可重用**

   * 用户下次可以继续使用这门课程
   * 或者针对同一资源重新选择不同老师风格学习

### 对应技术方案（高层）

* **资源接入层**

  * 支持多种输入类型：URL、文件上传、纯文本
  * 用不同的处理器（视频下载、文本提取）统一输出为“文档块”

* **内容处理 / 课程构建**

  * 视频：音频抽取 + ASR（转文字）
  * 文档：解析文本、分段
  * 基于时间/页数/语义，进行粗粒度的小节划分（可以先用简单规则）

* **课程模型（Course Model）**

  * 在数据层建立：

    * `Course`（课程级别）
    * `Lecture`（章节/讲次）
    * `Section`（知识点级别）
  * 每个 Section 绑定内容片段 & metadata（来源、时间段、页码等）

* **向量化 & 知识库构建**

  * 调用本地向量模型（Qwen3-Embedding-0.6B）将所有 Section 内容嵌入向量空间
  * 存入向量数据库（如 Chroma），带上课程/小节等 metadata

---

## 三、用户故事 B：教师角色 & 教学风格可定义

> **作为用户**，
> 我希望可以选择老师的“角色”和“教学风格”，
> 比如严谨教授、幽默学长、循循善诱的辅导员、偏考试导向等，
> 让学习体验符合我的口味和水平。

### 需要的功能

1. **教师角色选择**

   * 用户在每次学习前可以选择：

     * 老师的人设（persona）：教授 / 学长 / 解题老师 / 轻松聊天型
     * 学科背景（数学老师 / CS 老师 等）
   * 可默认一个，后续可以切换

2. **教学风格设置**

   * 用户可以选择：

     * 难度：入门 / 普通 / 进阶
     * 风格：严肃 / 幽默 / 生活化比喻 / 考试技巧型
     * 节奏：讲得快一点 vs 慢一点，提问频率多少

3. **教学行为受风格影响**

   * 讲解中用词、示例、结构不一样
   * 提问方式和问题难度随风格变化
   * 对错误的反馈方式不同（温和 vs 直接）

### 对应技术方案（高层）

* **教师配置模型（Teacher Profile）**

  * 对每个老师角色保存：

    * 角色描述（persona）
    * 教学风格参数（语气、比喻习惯、提问频率、难度倾向）

* **LLM Prompt 设计**

  * 在调用大模型时，将当前 Teacher Profile 注入到 system 指令中：

    * “你是一位 XX 风格的老师…”
    * “针对初学者，用类比和生活例子解释…”

* **教学引擎与风格联动**

  * Teaching Engine 在决定“讲解长度”、“提问频率”、“问题难度”时，参考 Teacher Profile 的设定

> 底层向量模型不变，**知识是同一套**，只是“老师怎么讲”由 LLM + 角色配置决定。

---

## 四、用户故事 C：选择想学的内容（按小节或自然语言）

> **作为用户**，
> 我可以从课程大纲中直接选择某个小节来学，
> 也可以直接用自然语言说“老师，带我学一下 XXX”。

### 需要的功能

1. **课程大纲展示**

   * 显示由资源构建出的课程结构：章节、小节标题、简介等
   * 用户可以点击某小节启动学习

2. **自然语言意图识别**

   * 能识别用户输入是否是在“指定一个想学的话题”：

     * “我想学线性回归”
     * “给我讲下第一章的最后一节”

3. **小节定位 / 知识点匹配**

   * 将用户表达匹配到某个 Section 或一组 Section

### 对应技术方案（高层）

* **课程结构存储**（与用户故事 A 共用）
* **意图识别 + 语义匹配**：

  * 用户输入 → 向量化
  * 与 Section 的标题/摘要向量做相似度匹配
  * 结合规则（“第一章第二节”这种结构化描述）辅助定位

---

## 五、用户故事 D：完整知识点讲解 + 智能互动

> **作为用户**，
> 我希望老师在每个知识点上都：
> 先完整讲解 → 再问我一个或两个理解问题 → 再根据我的回答调整讲解。

### 需要的功能

1. **按 Section 检索内容并生成讲解**
2. **生成与当前内容紧密相关的理解检查问题**
3. **判断用户回答的正确性/理解程度**
4. **决定：继续 / 补充解释 / 换一种方式讲**

### 对应技术方案（高层）

* **Teaching Engine（教学引擎）**

  * 持有当前 Section 状态
  * pipeline 大致为：

    * RAG 检索该 Section 相关内容
    * LLM 生成讲解内容（受教师风格影响）
    * LLM 再根据讲解内容生成问题
    * 分析用户回答，决定下一步行为

* **RAG（按 Section 过滤检索）**

  * 向量库里所有 chunk 带 Section metadata
  * 检索时按 Section 过滤，保证知识上下文一致

---

## 六、用户故事 E：随时打断老师提问（特定前缀触发）

> **作为用户**，
> 我在听课时，随时可以打断老师说：「老师，我不懂刚才那个例子」。

### 需要的功能

1. **识别当前输入是“提问”行为**

   * 简单规则：以“老师，”或“Teacher,” 开头
   * 配合 LLM 检查是否为问题句

2. **中断当前教学流程进行问答**

   * 暂停当前 Section 的讲解/互动流程
   * 使用 RAG 针对这个问题检索 & 回答

3. **回答后恢复到原来教学流程**

   * 回答完之后，Teacher 主动说“我们回到刚才的内容”，继续上下文

### 对应技术方案（高层）

* **输入类型识别模块**

  * 教学引擎入口：先做规则判断 + 简单分类（学习意图 / 提问 / 反馈）

* **临时状态保存**

  * 每次进入问答前，保存当前 Teaching State（Section、进度、教师风格等）

* **问答模式**

  * 使用同一 RAG + LLM，但 prompt 说明当前是“回答问题，不推进课程”

* **状态恢复**

  * 回答完后恢复 Teaching State
  * 再继续原知识点的讲解或下一步互动

---

## 七、用户故事 F：音频学习（播客式体验）

> **作为用户**，
> 我希望老师讲课时的内容也可以用音频的形式播放，就像听播客一样。

### 需要的功能

1. **讲解/回答文本 → 音频转换**
2. **音频文件存储与访问**
3. **前端播放器**

### 对应技术方案（高层）

* **TTS 引擎**

  * 输入：Teacher 生成的文本（受风格影响）
  * 输出：音频文件或音频流

* **音频管理**

  * 为每轮讲解/回答生成一个唯一音频地址
  * 在 API 响应里携带 `audio_url` 字段

* **前端音频播放器组件**

  * 支持播放 / 暂停
  * 与对应的文本消息一起展示

---

## 八、整体小结（你可以拿这版做“需求确认”）

这版已经把你提出的**三个关键点**都覆盖到：

* ✅ 用户可以自选/上传资源 → 系统转成课程（用户故事 A）
* ✅ 教师角色和教学风格可定义（用户故事 B）
* ✅ 互动式教学，不是只讲第一节，而是按课程小节 + 对话式学习（C～F）

同时，每个用户故事都已经映射到了：

* **需要实现的能力（功能）**
* **大致要用什么技术/模块去实现（技术方案，高层级）**

还没有拆解到“脚本名、接口名、代码结构”，完全符合你现在说的“先确认思路”的阶段。

---

你可以先看一下：

* 有没有哪个用户故事还缺你心里觉得重要的使用场景？
* 比如：

  * “老师记住我学过哪些小节，下次能自动推荐复习”
  * “同一套资源，用不同老师风格重新学习”

如果这版你觉得 OK，我们下一步就可以按你的要求：

> **基于这些用户故事，把功能拆解成更细的开发任务（按模块拆分、考虑依赖顺序），但仍然先不写具体代码。**
